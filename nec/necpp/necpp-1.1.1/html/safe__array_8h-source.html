<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>nec++: safe_array.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">src</a></div>
<h1>safe_array.h</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment">        Copyright (C) 2004  Timothy C.A. Molteno</span>
00003 <span class="comment">        </span>
00004 <span class="comment">        This program is free software; you can redistribute it and/or modify</span>
00005 <span class="comment">        it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment">        the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment">        (at your option) any later version.</span>
00008 <span class="comment">        </span>
00009 <span class="comment">        This program is distributed in the hope that it will be useful,</span>
00010 <span class="comment">        but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment">        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment">        GNU General Public License for more details.</span>
00013 <span class="comment">        </span>
00014 <span class="comment">        You should have received a copy of the GNU General Public License</span>
00015 <span class="comment">        along with this program; if not, write to the Free Software</span>
00016 <span class="comment">        Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00017 <span class="comment">*/</span>
00018 <span class="preprocessor">#ifndef __safe_array__</span>
00019 <span class="preprocessor"></span><span class="preprocessor">#define __safe_array__</span>
00020 <span class="preprocessor"></span>
00021 <span class="preprocessor">#include &lt;iostream&gt;</span>
00022 <span class="preprocessor">#include &lt;string&gt;</span>
00023 <span class="preprocessor">#include &lt;sstream&gt;</span>
00024 
00025 <span class="preprocessor">#ifdef NEC_ERROR_CHECK</span>
00026 <span class="preprocessor"></span>
00027 <span class="preprocessor">#include "nec_exception.h"</span>
00028 
00029 <span class="keyword">class </span>BoundsViol : <span class="keyword">public</span> nec_exception
00030 {
00031 <span class="keyword">public</span>:
00032         BoundsViol(<span class="keyword">const</span> <span class="keywordtype">char</span>* message, <span class="keywordtype">long</span> index, <span class="keywordtype">long</span> bound)
00033                 : nec_exception(message)
00034         {
00035                 m_message &lt;&lt; <span class="stringliteral">"array index: "</span> &lt;&lt; index &lt;&lt; <span class="stringliteral">" exceeds "</span> &lt;&lt; bound &lt;&lt; std::endl;
00036         }
00037 };
00038 <span class="preprocessor">#endif</span>
00039 <span class="preprocessor"></span>
00047 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00048"></a><a class="code" href="classsafe__array.html">00048</a> <span class="keyword">class </span><a class="code" href="classsafe__array.html">safe_array</a>
00049 {
00050 <span class="keyword">public</span>:
00051         <a class="code" href="classsafe__array.html">safe_array</a>()
00052                 : len_(0), rows_(0), cols_(0), data_(NULL), data_size_(0), own_data_(<span class="keyword">true</span>)
00053         { }
00054 
00055         <a class="code" href="classsafe__array.html">safe_array</a>(<span class="keywordtype">long</span> size)
00056                 : len_(0), rows_(0), cols_(0), data_(NULL), data_size_(0), own_data_(<span class="keyword">true</span>)
00057         {
00058                 resize(size);
00059         }
00060         
00061         <a class="code" href="classsafe__array.html">safe_array</a>(<span class="keywordtype">long</span> n_rows, <span class="keywordtype">long</span> n_cols)
00062                 : len_(0), rows_(0), cols_(0), data_(NULL), data_size_(0), own_data_(<span class="keyword">true</span>)
00063         {
00064                 resize(n_rows, n_cols);
00065         }
00066         
00067         <a class="code" href="classsafe__array.html">safe_array</a>(<span class="keyword">const</span> <a class="code" href="classsafe__array.html">safe_array&lt;T&gt;</a>&amp; in_array)
00068                 : len_(0), rows_(0), cols_(0), data_(NULL), data_size_(0), own_data_(<span class="keyword">true</span>)
00069         {
00070                 copy(in_array);
00071         }
00072         
00073         ~<a class="code" href="classsafe__array.html">safe_array</a>()
00074         {
00075                 <span class="keywordflow">if</span> (own_data_)
00076                         <span class="keyword">delete</span>[] data_;
00077         }
00078         
00079         <span class="keywordtype">long</span> size()<span class="keyword"> const</span>
00080 <span class="keyword">        </span>{
00081                 <span class="keywordflow">return</span> len_;
00082         }
00083 
00084         <span class="keywordtype">void</span> resize(<span class="keywordtype">long</span> n_rows, <span class="keywordtype">long</span> n_cols)
00085         {
00086                 rows_ = n_rows;
00087                 cols_ = n_cols;
00088                 
00089                 resize(rows_ * cols_);
00090         }
00091 
00092         <span class="comment">// Copy the contents of in_array to our array</span>
00093         <span class="comment">// resizing as appropriate.</span>
00094         <span class="keywordtype">void</span> copy(<span class="keyword">const</span> <a class="code" href="classsafe__array.html">safe_array&lt;T&gt;</a>&amp; in_array)
00095         {
00096                 <span class="keywordflow">if</span> (in_array.<a class="code" href="classsafe__array.html#r1">rows_</a> == 0)
00097                         resize(in_array.<a class="code" href="classsafe__array.html#r0">len_</a>);
00098                 <span class="keywordflow">else</span>
00099                         resize(in_array.<a class="code" href="classsafe__array.html#r1">rows_</a>,in_array.<a class="code" href="classsafe__array.html#r2">cols_</a>);
00100                         
00101                 <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;len_; i++)
00102                         data_[i] = in_array[i];
00103         }
00104 
00105         <span class="keywordtype">void</span> resize(<span class="keywordtype">long</span> new_length)
00106         {
00107 <span class="preprocessor">#ifdef NEC_ERROR_CHECK</span>
00108 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (! own_data_)
00109                         <span class="keywordflow">throw</span> <span class="keyword">new</span> nec_exception(<span class="stringliteral">"attempt to resize data we do not own"</span>);
00110 <span class="preprocessor">#endif                  </span>
00111 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (new_length &gt; data_size_)
00112                 {
00113                         T* new_data_ = <span class="keyword">new</span> T[new_length];
00114                         data_size_ = new_length;        <span class="comment">// keep the actual data size...</span>
00115                         
00116                         <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;len_; i++)
00117                                 new_data_[i] = data_[i];
00118                 
00119                         <span class="keyword">delete</span>[] data_;
00120                         data_ = new_data_;
00121                         len_ = new_length;
00122                 }
00123                 <span class="keywordflow">else</span>
00124                 {
00125                         len_ = new_length;
00126                 }
00127         }
00128         
00129         <span class="comment">// return the largest element of the array</span>
00130         T max()
00131         {
00132                 T ret = data_[check(0)];
00133                 
00134                 <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i = 1; i &lt; len_; i++ )
00135                 {
00136                         <span class="keywordflow">if</span> ( data_[check(i)] &gt; ret)
00137                                 ret = data_[check(i)];
00138                 }
00139                 <span class="keywordflow">return</span> ret;
00140         }
00141 
00142         <span class="comment">// return the sum of all elements in the array</span>
00143         T sum(<span class="keywordtype">long</span> start_index, <span class="keywordtype">long</span> stop_index)
00144         {
00145                 T ret = data_[check(start_index)];
00146                 
00147                 <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i = start_index+1; i &lt; stop_index; i++ )
00148                 {
00149                         ret += data_[check(i)];
00150                 }
00151                 <span class="keywordflow">return</span> ret;
00152         }
00153 
00154         <span class="comment">// return the sum of all elements in the array</span>
00155         T sum()
00156         {
00157                 <span class="keywordflow">return</span> sum(0,len_);
00158         }
00159 
00160         <span class="comment">// fill all elements of the array with x</span>
00161         <span class="keywordtype">void</span> fill(<span class="keywordtype">long</span> start, <span class="keywordtype">long</span> N, <span class="keyword">const</span> T&amp; x)
00162         {
00163                 <span class="keywordtype">long</span> stop = start + N;
00164                 <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i = start; i &lt; stop; i++ )
00165                 {
00166                         data_[check(i)] = x;
00167                 }
00168         }
00169         
00170         <span class="comment">// fill all elements of the array with x</span>
00171         <span class="keywordtype">void</span> fill(<span class="keyword">const</span> T&amp; x)
00172         {
00173                 fill(0,len_,x);
00174         }
00175                 
00176         T&amp; get(<span class="keywordtype">long</span> row, <span class="keywordtype">long</span> col)
00177         {
00178                 <span class="keywordflow">return</span> data_[check(row,col)];
00179         }
00180 
00181         <span class="keywordtype">void</span> set(<span class="keywordtype">long</span> row, <span class="keywordtype">long</span> col, <span class="keyword">const</span> T&amp; x)
00182         {
00183                 data_[check(row,col)] = x;
00184         }
00185         
00186         <span class="keyword">const</span> T&amp; operator[](<span class="keywordtype">long</span> i)<span class="keyword"> const</span>
00187 <span class="keyword">        </span>{
00188                 <span class="keywordflow">return</span> data_[check(i)];
00189         }
00190         
00191         T&amp; operator[](<span class="keywordtype">long</span> i)
00192         {
00193                 <span class="keywordflow">return</span> data_[check(i)];
00194         }
00195         
00196         <span class="comment">// if end_index is -1, then finish at the end of the array</span>
00197         <a class="code" href="classsafe__array.html">safe_array&lt;T&gt;</a> sub_array(<span class="keywordtype">long</span> start_index, <span class="keywordtype">long</span> end_index = -1)
00198         {
00199                 <span class="keywordflow">if</span> (-1 == end_index)
00200                         end_index = len_;
00201                         
00202                 <span class="keywordflow">return</span> <a class="code" href="classsafe__array.html">safe_array&lt;T&gt;</a>(*<span class="keyword">this</span>, start_index, end_index, <span class="keyword">false</span>);
00203         }
00204         
00205         
00206         T* get_ptr()<span class="keyword"> const</span>
00207 <span class="keyword">        </span>{
00208                 <span class="keywordflow">return</span> data_;
00209         }
00210         
00211         
00212         <a class="code" href="classsafe__array.html">safe_array&lt;T&gt;</a>&amp; operator=(<span class="keyword">const</span> <a class="code" href="classsafe__array.html">safe_array&lt;T&gt;</a>&amp; in_array)
00213         {
00214                 copy(in_array);
00215                 <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00216         }
00217 
00218 <span class="keyword">private</span>:
00219         <span class="keywordtype">long</span> len_;
00220         <span class="keywordtype">long</span> rows_;
00221         <span class="keywordtype">long</span> cols_;
00222         
00223         T*  data_;
00224         <span class="keywordtype">long</span> data_size_;
00225         
00226         <span class="keywordtype">bool</span> own_data_;
00227         
00228         <span class="comment">// Used to constructing sub_array's</span>
00229         <a class="code" href="classsafe__array.html">safe_array</a>(<a class="code" href="classsafe__array.html">safe_array&lt;T&gt;</a>&amp; in_array, <span class="keywordtype">long</span> start_index, <span class="keywordtype">long</span> end_index, <span class="keywordtype">bool</span> in_copy_data)
00230         {
00231                 len_ = (end_index - start_index);
00232                 rows_ = 0;
00233                 cols_ = 0;
00234                 
00235                 <span class="keywordflow">if</span> (in_copy_data)
00236                 {
00237                         T* data_ = <span class="keyword">new</span> T[len_];
00238                         data_size_ = len_;
00239                         
00240                         <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i=0; i&lt;len_; i++)
00241                                 data_[check(i)] = in_array[start_index + i];
00242                 
00243                         own_data_ = <span class="keyword">true</span>;
00244                 }
00245                 <span class="keywordflow">else</span>
00246                 {
00247                         data_ = in_array.<a class="code" href="classsafe__array.html#a19">get_ptr</a>() + start_index;
00248                         data_size_ = 0;
00249                         own_data_ = <span class="keyword">false</span>;
00250                 }
00251         }
00252         
00253         <span class="keyword">inline</span> <span class="keywordtype">long</span> check(<span class="keywordtype">long</span> i)<span class="keyword"> const</span>
00254 <span class="keyword">        </span>{
00255 <span class="preprocessor">#ifdef NEC_ERROR_CHECK</span>
00256 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (i &lt; 0 || i &gt;= len_)
00257                         <span class="keywordflow">throw</span> <span class="keyword">new</span> BoundsViol(<span class="stringliteral">"safe_array"</span>, i, len_);
00258 <span class="preprocessor">#endif</span>
00259 <span class="preprocessor"></span>                <span class="keywordflow">return</span> i;
00260         }
00261 
00262         <span class="keyword">inline</span> <span class="keywordtype">long</span> check(<span class="keywordtype">long</span> row, <span class="keywordtype">long</span> col)<span class="keyword"> const</span>
00263 <span class="keyword">        </span>{
00264 <span class="preprocessor">#ifdef NEC_ERROR_CHECK</span>
00265 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (row &lt; 0 || row &gt;= rows_)
00266                         <span class="keywordflow">throw</span> <span class="keyword">new</span> BoundsViol(<span class="stringliteral">"safe_array"</span>, row, rows_);
00267                 <span class="keywordflow">if</span> (col &lt; 0 || col &gt;= cols_)
00268                         <span class="keywordflow">throw</span> <span class="keyword">new</span> BoundsViol(<span class="stringliteral">"safe_array"</span>, col, cols_);
00269 <span class="preprocessor">#endif</span>
00270 <span class="preprocessor"></span>                <span class="keywordflow">return</span> check(row*cols_ + col);
00271         }
00272 }; 
00273 
00274 
00275 <span class="preprocessor">#endif </span><span class="comment">/* __safe_array__ */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Nov 23 11:15:17 2004 for nec++ by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
